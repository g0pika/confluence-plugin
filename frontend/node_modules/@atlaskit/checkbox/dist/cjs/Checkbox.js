"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var react_1 = tslib_1.__importStar(require("react"));
var analytics_next_1 = require("@atlaskit/analytics-next");
var emotion_theming_1 = require("emotion-theming");
var CheckboxIcon_1 = tslib_1.__importDefault(require("./CheckboxIcon"));
var version_json_1 = require("./version.json");
var Checkbox_1 = require("./styled/Checkbox");
var emptyTheme = {};
var Checkbox = /** @class */ (function (_super) {
    tslib_1.__extends(Checkbox, _super);
    function Checkbox() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.state = {
            isActive: false,
            isFocused: false,
            isHovered: false,
            isMouseDown: false,
            isChecked: _this.props.isChecked !== undefined
                ? _this.props.isChecked
                : _this.props.defaultChecked,
        };
        _this.checkbox = undefined;
        _this.actionKeys = [' '];
        _this.onChange = function (event) {
            if (_this.props.isDisabled) {
                return null;
            }
            event.persist();
            if (event.target.checked !== undefined) {
                _this.setState({ isChecked: event.target.checked });
            }
            if (_this.props.onChange) {
                _this.props.onChange(event);
            }
            return true;
        };
        // expose blur/focus to consumers via ref
        _this.blur = function () {
            if (_this.checkbox && _this.checkbox.blur) {
                _this.checkbox.blur();
            }
        };
        _this.focus = function () {
            if (_this.checkbox && _this.checkbox.focus) {
                _this.checkbox.focus();
            }
        };
        _this.onBlur = function () {
            return _this.setState({
                // onBlur is called after onMouseDown if the checkbox was focused, however
                // in this case on blur is called immediately after, and we need to check
                // whether the mouse is down.
                isActive: _this.state.isMouseDown && _this.state.isActive,
                isFocused: false,
            });
        };
        _this.onFocus = function () { return _this.setState({ isFocused: true }); };
        _this.onMouseLeave = function () { return _this.setState({ isActive: false, isHovered: false }); };
        _this.onMouseEnter = function () { return _this.setState({ isHovered: true }); };
        _this.onMouseUp = function () { return _this.setState({ isActive: false, isMouseDown: false }); };
        _this.onMouseDown = function () { return _this.setState({ isActive: true, isMouseDown: true }); };
        _this.onKeyDown = function (event) {
            if (event.key in _this.actionKeys) {
                _this.setState({ isActive: true });
            }
        };
        _this.onKeyUp = function (event) {
            if (event.key in _this.actionKeys) {
                _this.setState({ isActive: false });
            }
        };
        return _this;
    }
    Checkbox.prototype.componentDidMount = function () {
        var isIndeterminate = this.props.isIndeterminate;
        // there is no HTML attribute for indeterminate, and thus no prop equivalent.
        // it must be set via the ref.
        if (this.checkbox) {
            this.checkbox.indeterminate = !!isIndeterminate;
            if (this.props.inputRef) {
                this.props.inputRef(this.checkbox);
            }
        }
    };
    Checkbox.prototype.componentDidUpdate = function (prevProps) {
        var isIndeterminate = this.props.isIndeterminate;
        if (prevProps.isIndeterminate !== isIndeterminate && this.checkbox) {
            this.checkbox.indeterminate = !!isIndeterminate;
        }
    };
    Checkbox.prototype.render = function () {
        var _this = this;
        var _a = this.props, isDisabled = _a.isDisabled, isInvalid = _a.isInvalid, isIndeterminate = _a.isIndeterminate, label = _a.label, name = _a.name, value = _a.value, isRequired = _a.isRequired, 
        //props not passed into HiddenCheckbox
        defaultChecked = _a.defaultChecked, inputRef = _a.inputRef, propsIsChecked = _a.isChecked, isFullWidth = _a.isFullWidth, onChange = _a.onChange, rest = tslib_1.__rest(_a, ["isDisabled", "isInvalid", "isIndeterminate", "label", "name", "value", "isRequired", "defaultChecked", "inputRef", "isChecked", "isFullWidth", "onChange"]);
        var isChecked = this.props.isChecked === undefined
            ? this.state.isChecked
            : propsIsChecked;
        var _b = this.state, isFocused = _b.isFocused, isActive = _b.isActive, isHovered = _b.isHovered;
        return (react_1.default.createElement(emotion_theming_1.ThemeProvider, { theme: emptyTheme },
            react_1.default.createElement(Checkbox_1.Label, { isDisabled: isDisabled, onMouseDown: this.onMouseDown, onMouseEnter: this.onMouseEnter, onMouseLeave: this.onMouseLeave, onMouseUp: this.onMouseUp },
                react_1.default.createElement(Checkbox_1.CheckboxWrapper, null,
                    react_1.default.createElement(Checkbox_1.HiddenCheckbox, tslib_1.__assign({ disabled: isDisabled, checked: isChecked, onChange: this.onChange, onBlur: this.onBlur, onFocus: this.onFocus, onKeyUp: this.onKeyUp, onKeyDown: this.onKeyDown, type: "checkbox", value: value, name: name, ref: function (r) { return (_this.checkbox = r); }, required: isRequired }, rest)),
                    react_1.default.createElement(CheckboxIcon_1.default, { isChecked: isChecked, isDisabled: isDisabled, isFocused: isFocused, isActive: isActive, isHovered: isHovered, isInvalid: isInvalid, isIndeterminate: isIndeterminate, primaryColor: "inherit", secondaryColor: "inherit", label: "" })),
                react_1.default.createElement(Checkbox_1.LabelText, null,
                    label,
                    isRequired && (react_1.default.createElement(Checkbox_1.RequiredIndicator, { "aria-hidden": "true" }, "*"))))));
    };
    Checkbox.defaultProps = {
        isDisabled: false,
        isInvalid: false,
        defaultChecked: false,
        isIndeterminate: false,
    };
    return Checkbox;
}(react_1.Component));
exports.CheckboxWithoutAnalytics = Checkbox;
var createAndFireEventOnAtlaskit = analytics_next_1.createAndFireEvent('atlaskit');
exports.default = analytics_next_1.withAnalyticsContext({
    componentName: 'checkbox',
    packageName: version_json_1.name,
    packageVersion: version_json_1.version,
})(analytics_next_1.withAnalyticsEvents({
    onChange: createAndFireEventOnAtlaskit({
        action: 'changed',
        actionSubject: 'checkbox',
        attributes: {
            componentName: 'checkbox',
            packageName: version_json_1.name,
            packageVersion: version_json_1.version,
        },
    }),
})(Checkbox));
//# sourceMappingURL=Checkbox.js.map