{"code":"(window.atlassianWebpackJsonp443cd0279e0da119d0d4637a8a554bda=window.atlassianWebpackJsonp443cd0279e0da119d0d4637a8a554bda||[]).push([[5],{236:function(e,t,a){\"use strict\";a.r(t);var n=a(0),r=a.n(n),o=a(192),l=a(190),s=a(196),c=a(231),i=a.n(c),p=a(232),d=a.n(p),u=a(235),m=a(191),y=a(194);const f=e=>{const[t,a]=Object(n.useState)(\"\");let o;Object(n.useEffect)(()=>{window.AP.getLocation((function(e){a(e)}))},[]),Object(n.useEffect)(()=>{},[e]);{let a=t.split(\"/\");o=((e,t,a)=>{let n=[],o=\"https://\"+a[2];return null!=e&&0!==e&&e.map(e=>{a[2]?n.push({cells:[{key:e.key,content:r.a.createElement(\"div\",{style:{display:\"flex\",alignItems:\"center\"}},r.a.createElement(m.a,{name:e.name,size:\"small\",src:o+e.profilePicURL}),r.a.createElement(\"span\",{style:{marginLeft:\"8px\"}},e.name)),isSortable:!0},{key:e.key,content:\"Can view Insights\"},{key:e.key,content:r.a.createElement(y.a,{appearance:\"link\",onClick:()=>t(e.key)},\"Remove\")}]}):n.push({cells:[{key:e.key,content:e.name,isSortable:!0},{key:e.key,content:\"Can view Insights\"},{key:e.key,content:r.a.createElement(y.a,{appearance:\"link\",onClick:()=>t(e.key)},\"Remove\")}]})}),n})(e.tabledata,e.onRemoveClick,a)}return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{head:{cells:[{key:\"headkey1\",content:\"Users\"},{key:\"headkey2\",content:\"Permissions\"},{key:\"headkey3\",content:\"Edit\"}]},rows:o,rowsPerPage:5}))};var E=a(195),g=a(199),h=a(172),k=a(237),w=a(230),v=a.n(w);const O=e=>{const[t,a]=Object(n.useState)(0),[o,l]=Object(n.useState)(0),[s,c]=Object(n.useState)(0),i=()=>0!==t&&0!==o?t.map(t=>r.a.createElement(g.a,{key:t.accountId||t.name,onClick:()=>{(t=>{console.log(\"data\",t.title);let a={};a=\"group\"===t.type?{name:t.name,key:t.name,profilePicURL:null}:{name:t.title,key:t.accountId,profilePicURL:t.thumbnailLink.href},console.log(\"data\",a),e.AddtoTable(a)})(t),c(0)}},t.title||t.name)):\"loading...\";return r.a.createElement(E.a,{position:\"bottom left\",isOpen:s,trigger:r.a.createElement(k.a,{name:\"search\",placeholder:\"Search for Users\",appearance:\"standard\",width:\"xlarge\",onBlur:()=>c(0),elemBeforeInput:r.a.createElement(\"div\",{style:{paddingLeft:\"6px\",lineHeight:\"100%\"}},r.a.createElement(v.a,null)),defaultValue:\"\",onChange:e=>{var t;e.target.value?(c(1),t=e.target.value,l(0),window.AP.request(\"/rest/prototype/1/search/user-or-group.json?max-results=10&query=\"+t,{contentType:\"application/json; charset=utf-8\",type:\"GET\",success:function(e){let t=JSON.parse(e);console.log(\"Search_response\",t.result),l(1),a(t.result)}}),console.log(\"Searching\")):c(0)}})},r.a.createElement(h.a,{title:\"Options\"},r.a.createElement(i,null)))},b=e=>{const[t,a]=Object(n.useState)([...e.Currentuser]),[o,l]=Object(n.useState)(!0);Object(n.useEffect)(()=>{a([...e.Currentuser])},[e.Currentuser]),Object(n.useEffect)(()=>{a([...t])},[o]);return r.a.createElement(\"div\",null,r.a.createElement(O,{AddtoTable:e=>{let n=t.filter(t=>t.key!==e.key);n.unshift(e),a([...n]),l(!o)}}),r.a.createElement(f,{tabledata:t,onRemoveClick:e=>{let n=t.filter(t=>t.key!==e);a([...n]),l(!o)},loading:e.loading}),r.a.createElement(\"div\",{style:{paddingTop:\"100px\"}},r.a.createElement(y.a,{appearance:\"primary\",onClick:()=>e.buttonClick(t)},\"Save\"),r.a.createElement(y.a,{appearance:\"link\",onClick:()=>e.setchecktype(!1)},\"Cancel\")))};var C=a(202),x=a.n(C),j=a(211),S=a.n(j);function D(e){let{dismiss:t}=e;const[a,o]=Object(n.useState)({flags:[r.a.createElement(!function(){var e=new Error(\"Cannot find module '@atlaskit/flag'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),{appearance:\"normal\",icon:r.a.createElement(S.a,{label:\"Success\"}),id:\"success\",key:\"success\",title:\"Saved\",description:\"Permission changes are saved\"})]});return r.a.createElement(!function(){var e=new Error(\"Cannot find module '@atlaskit/flag'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),{onDismissed:()=>{o({flags:[]}),t()}},a.flags)}!function(){var e=new Error(\"Cannot find module '@atlaskit/flag'\");throw e.code=\"MODULE_NOT_FOUND\",e}();var U=a(200);!function(){var e=new Error(\"Cannot find module '@atlaskit/section-message'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),function(){var e=new Error(\"Cannot find module '@atlaskit/tokens'\");throw e.code=\"MODULE_NOT_FOUND\",e}();t.default=()=>{const[e,t]=Object(n.useState)(!1),[a,c]=Object(n.useState)([]),[p,u]=Object(n.useState)(1),[m,f]=Object(n.useState)(0);let E=Object(n.useRef)(),g=Object(n.useRef)();Object(n.useEffect)(()=>{window.AP.resize()},[E.current]);Object(n.useEffect)(()=>{{let e=document.getElementById(\"jwt\");if(e){let t=e.content;window.AP.context.getContext(e=>{x.a.get(\"/permissions?spaceKey=\"+e.confluence.space.key,{headers:{Authorization:t}}).then(e=>{E.current=e.headers.authorization}).catch(e=>{console.info(\"Axios permission\",e.response)})})}else window.AP.context.getContext(e=>{g.current=e,window.AP.context.getToken(a=>{x.a.post(\"/authorize?jwt=\"+a+\"&spaceKey=\"+e.confluence.space.key+\"&lic=active\").then(a=>{x.a.get(\"/permissions?spaceKey=\"+e.confluence.space.key,{headers:{Authorization:a.headers.authorization}}).then(e=>{E.current=e.headers.authorization,0===e.data.permissions.length?(t(!1),window.AP.request(\"/rest/api/user/current\",{contentType:\"application/json; charset=utf-8\",type:\"GET\",success:function(e){var t=JSON.parse(e);c([{key:t.accountId,name:t.publicName,type:t.type,profilePicURL:t.profilePicture.path}]),u(0)}})):(c([...e.data.permissions]),t(!0),u(0))}).catch(e=>{console.info(\"Axios permission\",e.response)})})})})}},[]);const h=e=>{let t=0;t=0!==e?{permissions:e,spaceOverGlobal:!1}:{permissions:[],spaceOverGlobal:!1},x.a.post(\"/permissions?spaceKey=\"+g.current.confluence.space.key,t,{headers:{Authorization:E.current}}).then(e=>{E.current=e.headers.authorization,f(1)}).catch(e=>{console.info(\"Axios post\",e.response)})};return console.log(\"JET just before return is\",E.current),E.current?r.a.createElement(\"div\",{style:{minHeight:\"600px\"}},r.a.createElement(!function(){var e=new Error(\"Cannot find module '@atlaskit/section-message'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),{title:\"Setting permissions at the global level  is the easiest way to control who can view Insights\"},r.a.createElement(y.a,{appearance:\"link\",onClick:()=>{window.AP.navigator.go(\"addonModule\",{addonKey:\"com.view26.pageview-insights.spaces.confluence\",moduleKey:\"view26-insights-admin\"})}},\"Global permissions\"),r.a.createElement(y.a,{appearance:\"link\",onClick:()=>{window.open(\"https://help.view26.com/pifc/setup-and-administer/permissions\",\"_blank\")}},\"Learn more\")),r.a.createElement(\"div\",null,r.a.createElement(\"div\",{style:{paddingTop:\"20px\",paddingBottom:\"20px\",display:\"flex\",flexDirection:\"row\"}},r.a.createElement(o.a,{trigger:e?r.a.createElement(\"div\",{style:{display:\"flex\",flexDirection:\"row\"}},r.a.createElement(i.a,{primaryColor:\"red\"}),\"Apply Restrictions\"):r.a.createElement(\"div\",{style:{display:\"flex\",flexDirection:\"row\"}},r.a.createElement(d.a,{primaryColor:\"green\"}),\"No Restrictions\"),triggerType:\"button\",onOpenChange:e=>console.log(\"dropdown opened\",e)},r.a.createElement(l.a,null,r.a.createElement(s.a,{onClick:()=>{t(!1)}},r.a.createElement(\"div\",{style:{display:\"flex\",flexDirection:\"row\"}},r.a.createElement(d.a,{primaryColor:\"green\"}),r.a.createElement(\"span\",{style:{color:!function(){var e=new Error(\"Cannot find module '@atlaskit/tokens'\");throw e.code=\"MODULE_NOT_FOUND\",e}()(\"color.text\")}},\"No Restrictions\"))),r.a.createElement(s.a,{onClick:()=>{t(!0)}},r.a.createElement(\"div\",{style:{display:\"flex\",flexDirection:\"row\"}},r.a.createElement(i.a,{primaryColor:\"red\"}),r.a.createElement(\"span\",{style:{color:!function(){var e=new Error(\"Cannot find module '@atlaskit/tokens'\");throw e.code=\"MODULE_NOT_FOUND\",e}()(\"color.text\")}},\"Apply Restrictions\"))))),e?r.a.createElement(\"p\",{style:{margin:\"3px\"}},\"Only some people can view PageView Insights\"):r.a.createElement(\"p\",{style:{margin:\"3px\"}},\"All logged in users can view PageView Insights\"))),r.a.createElement(\"div\",null,e?r.a.createElement(b,{style:{paddingTop:\"5px\"},Currentuser:a,buttonClick:h,loading:p,setchecktype:t}):r.a.createElement(\"div\",null,r.a.createElement(\"div\",null,r.a.createElement(y.a,{appearance:\"primary\",onClick:()=>h(0)},\"Save\"))),r.a.createElement(\"div\",null,m?r.a.createElement(D,{dismiss:()=>f(0)}):r.a.createElement(r.a.Fragment,null)))):r.a.createElement(U.a,{size:\"large\"})}}}]);","extractedComments":[]}