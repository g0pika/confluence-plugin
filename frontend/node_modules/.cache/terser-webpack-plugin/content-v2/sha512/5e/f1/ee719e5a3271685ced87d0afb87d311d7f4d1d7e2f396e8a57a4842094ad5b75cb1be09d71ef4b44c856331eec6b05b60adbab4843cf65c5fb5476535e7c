{"code":"(window.atlassianWebpackJsonp443cd0279e0da119d0d4637a8a554bda=window.atlassianWebpackJsonp443cd0279e0da119d0d4637a8a554bda||[]).push([[5],{721:function(e,t,a){\"use strict\";a.r(t);var n=a(0),o=a.n(n),s=a(645),l=a(635),r=a(648),c=a(719),i=a(62);const p=(e,t,a)=>{let n=[];return null!==e&&(console.log(\"values\",e),e.map(e=>{console.log(\"item\",e.name),n.push({cells:[{key:e.name,content:e.name,isSortable:!0},{key:e.name+e.status,content:o.a.createElement(\"div\",{style:{marginLeft:\"45px\"}},o.a.createElement(c.a,{value:\"1\",name:\"checkbox-basic\",isDisabled:a,defaultChecked:e.status,onChange:a=>{t(a.currentTarget.checked,e)}})),isSortable:!0}],key:e.name+e.status})})),n},u={head:{cells:[{key:\"head key1\",content:o.a.createElement(\"h5\",{style:{color:Object(i.a)(\"color.text\")}},\"Group\"),width:84,shouldTruncate:!0},{key:\"head key2\",content:o.a.createElement(\"h5\",{style:{color:Object(i.a)(\"color.text\")}},\"Insights \"),colSpan:20,shouldTruncate:!0}]}},d={head:{cells:[{key:\"head key1\",width:42,content:o.a.createElement(\"h5\",{style:{color:Object(i.a)(\"color.text\")}},\"Name\")},{key:\"head key2\",content:o.a.createElement(\"h5\",{style:{color:Object(i.a)(\"color.text\")}},\"Key\"),width:42},{key:\"head key2\",content:o.a.createElement(\"h5\",{style:{color:Object(i.a)(\"color.text\")}},\"Operations\")}]}};var m=a(231),h=a(698),g=a.n(h),f=a(146),y=a.n(f),E=a(233),b=a.n(E),k=a(302),w=a(686);const v=e=>{const[t,a]=Object(n.useState)(0),[s,l]=Object(n.useState)(1);return Object(n.useEffect)(()=>{a(p(e.data,e.onChangecheck,e.ButtonState)),console.log(\"actual syn\",t),console.log(\"calling before transform\")},[e.data,e.onChangecheck,e.ButtonState]),o.a.createElement(k.a,{head:e.head,rows:t,rowsPerPage:5,isLoading:e.loading,onSetPage:t=>{a(p(e.data,e.onChangecheck,e.ButtonState)),l(t)},page:s,emptyView:o.a.createElement(\"h6\",{style:{color:Object(i.a)(\"color.text\")}},\"No matching records found\")})},S=e=>{let t=((e,t,a)=>{let n=e=>{if(window.location.search&&new RegExp(e+\"=([^&]*)\").exec(window.location.search)){var t=new RegExp(e+\"=([^&]*)\").exec(window.location.search)[1];return decodeURIComponent(t)}return\"\"},s=n(\"xdm_e\")+n(\"cp\"),l=[];return null!==e&&(console.log(\"values\",e),e.map(e=>{console.log(e),l.push({cells:[{key:e.key,content:e.name,isSortable:!0},{key:e.key,content:e.key,isSortable:!0},{key:e.key,content:o.a.createElement(\"a\",{target:\"_blank\",rel:\"noopener noreferrer\",href:s+\"/plugins/atlassian-connect/space-tools-tab.action?key=\"+e.key+\"&addonKey=com.view26.pageview-insights.spaces.confluence&moduleKey=view26-insights-permission\"},\" \",\"Manage Permissions\"),isSortable:!0}],key:e.key})})),l})(e.data);return o.a.createElement(w.a,{head:e.head,rows:t,rowsPerPage:5,isLoading:e.loading,emptyView:o.a.createElement(\"h6\",{style:{color:Object(i.a)(\"color.text\")}},\"No matching records found\")})};var x=a(110);t.default=()=>{const[e,t]=Object(n.useState)(null),[a,c]=Object(n.useState)(!0),[p,h]=Object(n.useState)(!1),[f,E]=Object(n.useState)(\"None\"),[k,w]=Object(n.useState)(),[O,T]=Object(n.useState)(null),[j,P]=Object(n.useState)(null),[z,C]=Object(n.useState)(!0),[A,I]=Object(n.useState)(!0);let R=0,G=0,N=0,J=0,q=(e,t)=>{let a=[],n=[],o=[];return t.permissions.map(e=>{n.push(e.name)}),e.results.map(e=>{a.push(e.name)}),a.forEach(e=>{n.includes(e)?o.push({name:e,status:!0}):o.push({name:e,status:!1})}),console.log(\"state array\",o),o};const B=e=>(console.log(\"refunction\",e),new Promise((function(t,a){window.AP.request(\"/rest/api/group?start=\"+e,{contentType:\"application/json; charset=utf-8\",type:\"GET\",success:function(e){let a=JSON.parse(e),n=a.limit;R+=a.size,console.log(\"limit refunction\",G,R,n),t(G<=R?a.results.slice():B(n))},error:function(e){a(JSON.parse(e))}})})));Object(n.useEffect)(()=>{window.AP.request(\"/rest/api/group?start=0\",{contentType:\"application/json; charset=utf-8\",type:\"GET\",success:async function(a){let n=JSON.parse(a);G=n.size;let o=n.limit;R+=o;let s=n.results.slice();if(G>R){(await B(o)).forEach(e=>{s.push(e)})}console.log(\"final result\",s),n.results.splice(0,n.results.length),s.forEach((function(e,t){n.results.push({key:e.name,name:e.name,type:e.type,profilePicURL:\"/app/favicon.png\"})})),console.log(\"response result\",n.results);let l=document.getElementById(\"jwt\");if(console.log(\"meta\",l),l){let a=l.content;console.log(\"Jwt token from index.html\",a),b.a.get(\"/permissions\",{headers:{Authorization:a}}).then(a=>{P(a.headers.authorization);let o=q(n,a.data);w(a.data.spaceOverGlobal),console.log(\"permissions data\",o),t(o),C(!1),console.info(\"table state\",e)}).catch(e=>{console.info(\"Permission data failed\",e.response)})}else window.AP.context.getToken(a=>{b.a.post(\"/authorize?jwt=\"+a+\"&spaceKey=&lic=active\").then(a=>{b.a.get(\"/permissions\",{headers:{Authorization:a.headers.authorization}}).then(a=>{P(a.headers.authorization);let o=q(n,a.data);w(a.data.spaceOverGlobal),console.log(\"permissions data\",o),t(o),C(!1),console.info(\"table state\",e)}).catch(e=>{console.info(\"Permission data failed\",e.response)})})})}}),window.AP.request(\"/rest/api/space?start=0\",{contentType:\"application/json; charset=utf-8\",type:\"GET\",success:async function(e){let t=JSON.parse(e);J=t.size;let a=t.limit;N+=a;let n=t.results.slice();if(t.results.splice(0,t.results.length),J>N){(await(e=>(console.log(\"refunction\",e),new Promise((function(t,a){window.AP.request(\"/rest/api/space?start=\"+e,{contentType:\"application/json; charset=utf-8\",type:\"GET\",success:function(e){let a=JSON.parse(e),n=a.limit;N+=a.size,console.log(\"limit refunction\",J,N,n),t(J<=N?a.results.slice():B(n))},error:function(e){a(JSON.parse(e))}})}))))(a)).forEach(e=>{n.push(e)})}console.log(\"actual results\",n),n.forEach((function(e,a){t.results.push({key:e.key,name:e.name,type:e._links.self,profilePicURL:\"/app/favicon.png\"})})),console.log(\"results of space\",t),T(t.results),I(!1)}})},[]);let L=t=>{if(t===k){let a=[];e.map(e=>{e.status&&(console.log(\"element with true\",e),a.push({key:e.name,name:e.name,type:\"group\",profilePicURL:\"/app/favicon.png\"}))});let n={permissions:a,spaceOverGlobal:!t};console.log(\"spacepermsiion payload\",n),b.a.post(\"/permissions\",n,{headers:{Authorization:j}}).then(e=>{console.info(\"Space dropdown changed\"),P(e.headers.authorization)}).catch(e=>{console.info(\"Space dropdown changed Failed \",e.response),console.info(\"Request payload \",n)}),w(!t)}};return o.a.createElement(x.e,null,o.a.createElement(\"div\",{style:{padding:25},className:\"ac-content\"},o.a.createElement(\"h3\",null,\"Global Permissions\"),o.a.createElement(\"div\",{style:{paddingTop:\"10px\",display:\"flex\",flexDirection:\"row\",justifyContent:\"space-between\"}},o.a.createElement(\"p\",null,\"Grant access to Insights for all the members of a group.\"),o.a.createElement(\"div\",null,o.a.createElement(m.a,{onClick:()=>{if(a)c(!1);else{c(!0);let t=[];console.log(\"Table state inside button click\",e),e.map(e=>{e.status&&(console.log(\"element wit true\",e),t.push({key:e.name,name:e.name,type:\"group\",profilePicURL:\"/app/favicon.png\"}))}),console.log(\"permission change request payload\",t),b.a.post(\"/permissions\",{permissions:t,spaceOverGlobal:k},{headers:{Authorization:j}}).then(e=>{console.info(\"Permissions changed\"),P(e.headers.authorization)}).catch(e=>{console.info(\"Permission change error \",e.response),console.info(\"Request payload \",t)})}},appearance:a?\"default\":\"primary\"},a?\"Edit Settings\":\"Save Settings\"))),o.a.createElement(\"div\",{style:{marginTop:\"5px\"}},o.a.createElement(v,{head:u.head,data:e,onChangecheck:(a,n)=>{let o=e;if(a)a&&(s=o.findIndex(e=>e.name===n.name),o[s]={name:n.name,status:!0},t(o));else{var s=o.findIndex(e=>e.name===n.name);o[s]={name:n.name,status:!1},t(o)}},ButtonState:a,loading:z}),o.a.createElement(\"h3\",null,\"Space Permissions\"),o.a.createElement(\"div\",{style:{marginTop:\"30px\",alignSelf:\"center\"}},o.a.createElement(s.a,{trigger:o.a.createElement(\"div\",null,k?o.a.createElement(n.Fragment,null,o.a.createElement(y.a,{primaryColor:\"red\",size:\"small\"}),\" If specified, space permission overrides global permission scheme\"):o.a.createElement(n.Fragment,null,o.a.createElement(g.a,{primaryColor:\"green\",size:\"small\"}),\" \",\"Allow global permission scheme to be applied to all Spaces\")),boundariesElement:\"window\",shouldFitContainer:\"false\",triggerType:\"button\"},o.a.createElement(l.a,{id:\"asda\",title:\"Options\"},o.a.createElement(r.a,{elemBefore:o.a.createElement(g.a,{primaryColor:\"green\",size:\"small\"}),style:{color:Object(i.a)(\"color.text\")},onClick:()=>L(!0)},\"Allow global permission scheme to be applied to all Spaces\"),o.a.createElement(r.a,{elemBefore:o.a.createElement(y.a,{primaryColor:\"red\",size:\"small\"}),onClick:()=>L(!1),style:{color:Object(i.a)(\"color.text\")}},\"If specified, space permission overrides global permission scheme\")))),o.a.createElement(\"div\",{style:{paddingTop:\"10px\",marginTop:\"30px\",color:Object(i.a)(\"color.text\")}},\"Further restrict who can use\",o.a.createElement(\"span\",{style:{fontWeight:\"bold\"}},\" Insights \"),\" at a space level.\"),o.a.createElement(\"div\",{style:{marginTop:\"5px\"}},o.a.createElement(S,{head:d.head,data:O,loading:A})),o.a.createElement(\"div\",null,o.a.createElement(\"h3\",null,\"REST API Token\"),o.a.createElement(\"div\",{style:{paddingTop:\"10px\"}},\"Your API key can be used to authenticate you when using the REST API. To use the API key refer to\",\" \",o.a.createElement(\"a\",{target:\"_blank\",rel:\"noopener noreferrer\",href:\"https://docs-view26.atlassian.net/wiki/spaces/PVIFC/pages/474972171/REST+API\"},\" \",\"REST API documentation.\")),o.a.createElement(\"div\",{style:{paddingTop:\"10px\",display:\"flex\",flexDirection:\"row\",justifyContent:\"space-between\"}},o.a.createElement(\"div\",{style:{paddingRight:\"50px\"}},p?o.a.createElement(\"div\",null,\" Token ID: \",f):o.a.createElement(\"div\",null,\" Token ID: \",f,\" \")),o.a.createElement(\"div\",{style:{alignContent:\"flex-end\"}},o.a.createElement(m.a,{onClick:()=>{p?(h(!1),E(\"None\")):(h(!0),b.a.post(\"/account/token\",{},{headers:{Authorization:j}}).then(e=>{P(e.headers.authorization),console.info(\"Token data\",e.data),E(e.data.token),h(!0)}).catch(e=>{console.info(\"Token failed\",e.response)}))}},p?o.a.createElement(\"div\",null,\"Revoke \"):o.a.createElement(\"div\",null,\"Generate \"))))))))}}}]);","extractedComments":[]}