{"code":"(window.atlassianWebpackJsonp443cd0279e0da119d0d4637a8a554bda=window.atlassianWebpackJsonp443cd0279e0da119d0d4637a8a554bda||[]).push([[4],{528:function(e,t,a){\"use strict\";a.r(t);var n=a(0),r=a.n(n),l=a(452),s=a(444),c=a(455),o=a(509),i=a.n(o),p=a(510),m=a.n(p),u=a(527),d=a(479),y=a(451),g=a(147);const E=e=>{const[t,a]=Object(n.useState)(\"\");let l;Object(n.useEffect)(()=>{window.AP.getLocation((function(e){a(e)}))},[]),Object(n.useEffect)(()=>{},[e]);{let a=t.split(\"/\");l=((e,t,a)=>{let n=[],l=\"https://\"+a[2];return null!=e&&0!==e&&e.map(e=>{a[2]?n.push({cells:[{key:e.key,content:r.a.createElement(\"div\",{style:{display:\"flex\",alignItems:\"center\"}},r.a.createElement(y.a,{name:e.name,size:\"small\",src:l+e.profilePicURL}),r.a.createElement(\"span\",{style:{marginLeft:\"8px\"}},e.name)),isSortable:!0},{key:e.key,content:\"Can view Insights\"},{key:e.key,content:r.a.createElement(g.a,{appearance:\"link\",onClick:()=>t(e.key)},\"Remove\")}]}):n.push({cells:[{key:e.key,content:e.name,isSortable:!0},{key:e.key,content:\"Can view Insights\"},{key:e.key,content:r.a.createElement(g.a,{appearance:\"link\",onClick:()=>t(e.key)},\"Remove\")}]})}),n})(e.tabledata,e.onRemoveClick,a)}return r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{head:{cells:[{key:\"headkey1\",content:\"Users\"},{key:\"headkey2\",content:\"Permissions\"},{key:\"headkey3\",content:\"Edit\"}]},rows:l,rowsPerPage:5}))};var h=a(454),f=a(459),k=a(210),w=a(485),v=a(362),b=a.n(v);const x=e=>{const[t,a]=Object(n.useState)(0),[l,s]=Object(n.useState)(0),[c,o]=Object(n.useState)(0),i=()=>0!==t&&0!==l?t.map(t=>r.a.createElement(f.a,{key:t.accountId||t.name,onClick:()=>{(t=>{console.log(\"data\",t.title);let a={};a=\"group\"===t.type?{name:t.name,key:t.name,profilePicURL:null}:{name:t.title,key:t.accountId,profilePicURL:t.thumbnailLink.href},console.log(\"data\",a),e.AddtoTable(a)})(t),o(0)}},t.title||t.name)):\"loading...\";return r.a.createElement(h.a,{position:\"bottom left\",isOpen:c,trigger:r.a.createElement(w.a,{name:\"search\",placeholder:\"Search for Users\",appearance:\"standard\",width:\"xlarge\",onBlur:()=>o(0),elemBeforeInput:r.a.createElement(\"div\",{style:{paddingLeft:\"6px\",lineHeight:\"100%\"}},r.a.createElement(b.a,null)),defaultValue:\"\",onChange:e=>{var t;e.target.value?(o(1),t=e.target.value,s(0),window.AP.request(\"/rest/prototype/1/search/user-or-group.json?max-results=10&query=\"+t,{contentType:\"application/json; charset=utf-8\",type:\"GET\",success:function(e){let t=JSON.parse(e);console.log(\"Search_response\",t.result),s(1),a(t.result)}}),console.log(\"Searching\")):o(0)}})},r.a.createElement(k.a,{title:\"Options\"},r.a.createElement(i,null)))},C=e=>{const[t,a]=Object(n.useState)([...e.Currentuser]),[l,s]=Object(n.useState)(!0);Object(n.useEffect)(()=>{a([...e.Currentuser])},[e.Currentuser]),Object(n.useEffect)(()=>{a([...t])},[l]);return r.a.createElement(\"div\",null,r.a.createElement(x,{AddtoTable:e=>{let n=t.filter(t=>t.key!==e.key);n.unshift(e),a([...n]),s(!l)}}),r.a.createElement(E,{tabledata:t,onRemoveClick:e=>{let n=t.filter(t=>t.key!==e);a([...n]),s(!l)},loading:e.loading}),r.a.createElement(\"div\",{style:{paddingTop:\"100px\"}},r.a.createElement(g.a,{appearance:\"primary\",onClick:()=>e.buttonClick(t)},\"Save\"),r.a.createElement(g.a,{appearance:\"link\",onClick:()=>e.setchecktype(!1)},\"Cancel\")))};var O=a(213),j=a.n(O),S=a(490),A=a.n(S),P=a(525),R=a(496);function T(e){let{dismiss:t}=e;const[a,l]=Object(n.useState)({flags:[r.a.createElement(P.a,{appearance:\"normal\",icon:r.a.createElement(A.a,{label:\"Success\"}),id:\"success\",key:\"success\",title:\"Saved\",description:\"Permission changes are saved\"})]});return r.a.createElement(R.a,{onDismissed:()=>{l({flags:[]}),t()}},a.flags)}var z=a(460),I=a(41);t.default=()=>{const[e,t]=Object(n.useState)(!1),[a,o]=Object(n.useState)([]),[p,d]=Object(n.useState)(1),[y,E]=Object(n.useState)(0);let h=Object(n.useRef)(),f=Object(n.useRef)();Object(n.useEffect)(()=>{window.AP.resize()},[h.current]);Object(n.useEffect)(()=>{{let e=document.getElementById(\"jwt\");if(e){let t=e.content;window.AP.context.getContext(e=>{j.a.get(\"/permissions?spaceKey=\"+e.confluence.space.key,{headers:{Authorization:t}}).then(e=>{h.current=e.headers.authorization}).catch(e=>{console.info(\"Axios permission\",e.response)})})}else window.AP.context.getContext(e=>{f.current=e,window.AP.context.getToken(a=>{j.a.post(\"/authorize?jwt=\"+a+\"&spaceKey=\"+e.confluence.space.key+\"&lic=active\").then(a=>{j.a.get(\"/permissions?spaceKey=\"+e.confluence.space.key,{headers:{Authorization:a.headers.authorization}}).then(e=>{h.current=e.headers.authorization,0===e.data.permissions.length?(t(!1),window.AP.request(\"/rest/api/user/current\",{contentType:\"application/json; charset=utf-8\",type:\"GET\",success:function(e){var t=JSON.parse(e);o([{key:t.accountId,name:t.publicName,type:t.type,profilePicURL:t.profilePicture.path}]),d(0)}})):(o([...e.data.permissions]),t(!0),d(0))}).catch(e=>{console.info(\"Axios permission\",e.response)})})})})}},[]);const k=e=>{let t=0;t=0!==e?{permissions:e,spaceOverGlobal:!1}:{permissions:[],spaceOverGlobal:!1},j.a.post(\"/permissions?spaceKey=\"+f.current.confluence.space.key,t,{headers:{Authorization:h.current}}).then(e=>{h.current=e.headers.authorization,E(1)}).catch(e=>{console.info(\"Axios post\",e.response)})};return console.log(\"JET just before return is\",h.current),h.current?r.a.createElement(\"div\",{style:{minHeight:\"600px\"}},r.a.createElement(u.a,{title:\"Setting permissions at the global level  is the easiest way to control who can view Insights\"},r.a.createElement(g.a,{appearance:\"link\",onClick:()=>{window.AP.navigator.go(\"addonModule\",{addonKey:\"com.view26.pageview-insights.spaces.confluence\",moduleKey:\"view26-insights-admin\"})}},\"Global permissions\"),r.a.createElement(g.a,{appearance:\"link\",onClick:()=>{window.open(\"https://help.view26.com/pifc/setup-and-administer/permissions\",\"_blank\")}},\"Learn more\")),r.a.createElement(\"div\",null,r.a.createElement(\"div\",{style:{paddingTop:\"20px\",paddingBottom:\"20px\",display:\"flex\",flexDirection:\"row\"}},r.a.createElement(l.a,{trigger:e?r.a.createElement(\"div\",{style:{display:\"flex\",flexDirection:\"row\"}},r.a.createElement(i.a,{primaryColor:\"red\"}),\"Apply Restrictions\"):r.a.createElement(\"div\",{style:{display:\"flex\",flexDirection:\"row\"}},r.a.createElement(m.a,{primaryColor:\"green\"}),\"No Restrictions\"),triggerType:\"button\",onOpenChange:e=>console.log(\"dropdown opened\",e)},r.a.createElement(s.a,null,r.a.createElement(c.a,{onClick:()=>{t(!1)}},r.a.createElement(\"div\",{style:{display:\"flex\",flexDirection:\"row\"}},r.a.createElement(m.a,{primaryColor:\"green\"}),r.a.createElement(\"span\",{style:{color:Object(I.a)(\"color.text\")}},\"No Restrictions\"))),r.a.createElement(c.a,{onClick:()=>{t(!0)}},r.a.createElement(\"div\",{style:{display:\"flex\",flexDirection:\"row\"}},r.a.createElement(i.a,{primaryColor:\"red\"}),r.a.createElement(\"span\",{style:{color:Object(I.a)(\"color.text\")}},\"Apply Restrictions\"))))),e?r.a.createElement(\"p\",{style:{margin:\"3px\"}},\"Only some people can view PageView Insights\"):r.a.createElement(\"p\",{style:{margin:\"3px\"}},\"All logged in users can view PageView Insights\"))),r.a.createElement(\"div\",null,e?r.a.createElement(C,{style:{paddingTop:\"5px\"},Currentuser:a,buttonClick:k,loading:p,setchecktype:t}):r.a.createElement(\"div\",null,r.a.createElement(\"div\",null,r.a.createElement(g.a,{appearance:\"primary\",onClick:()=>k(0)},\"Save\"))),r.a.createElement(\"div\",null,y?r.a.createElement(T,{dismiss:()=>E(0)}):r.a.createElement(r.a.Fragment,null)))):r.a.createElement(z.a,{size:\"large\"})}}}]);","extractedComments":[]}